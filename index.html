<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í†µí•© ë¶„ì„ ë° ë°°ì¹˜ ì‹œìŠ¤í…œ</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
:root{--p:#007bff;--s:#6c757d;--g:#28a745;--b:#dee2e6;--l:#f8f9fa;--w:white;--t:#1f2937;--m:#9ca3af;--sh:0 1px 3px rgba(0,0,0,0.1);--r:8px}
*{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;box-sizing:border-box}
body{background:var(--l);margin:0;padding:10px;line-height:1.5}
.main-container{display:flex;flex-direction:column;min-height:100vh}
.header{background:var(--w);border-radius:var(--r);box-shadow:var(--sh);margin-bottom:15px;padding:20px}
.header h1{font-size:24px;font-weight:bold;color:var(--t);margin:0 0 8px 0}
.gnb{display:flex;gap:8px;margin-top:15px}
.gnb-btn{border:none;padding:12px 24px;border-radius:var(--r);font-weight:600;cursor:pointer;transition:all 0.2s;font-size:14px;background:var(--l);color:var(--s);border:2px solid var(--b)}
.gnb-btn.active{background:var(--p);color:var(--w);border-color:var(--p)}
.gnb-btn:hover{border-color:var(--p)}
.content{display:flex;gap:15px;flex:1;min-height:0}
.sidebar{width:280px;flex-shrink:0}
.main-area{flex:1;min-width:0;background:var(--l);border-radius:var(--r);padding:15px;display:flex;flex-direction:column}
.card{background:var(--w);border-radius:var(--r);box-shadow:var(--sh);border:1px solid var(--b);margin-bottom:15px}
.card-body{padding:15px}
.btn{border:none;padding:8px 16px;border-radius:4px;font-weight:500;cursor:pointer;transition:all 0.2s;font-size:14px;display:inline-flex;align-items:center;gap:6px}
.btn-primary{background:var(--p);color:var(--w)}.btn-primary:hover{background:#0056b3}
.btn-secondary{background:var(--s);color:var(--w)}
.btn-success{background:var(--g);color:var(--w)}
.btn-danger{background:#dc3545;color:var(--w)}
.btn-sm{padding:6px 12px;font-size:12px}
.btn-lg{padding:16px 32px;font-size:16px;font-weight:600}
.upload-zone{border:2px dashed var(--p);border-radius:var(--r);padding:30px;text-align:center;background:var(--l);cursor:pointer;transition:all 0.3s}
.upload-zone:hover,.upload-zone.drag-over{background:#e3f2fd;border-color:#0056b3;transform:scale(1.02)}
.upload-zone svg{width:24px;height:24px;color:var(--p);margin:0 auto 8px auto;display:block}
.form-group{margin-bottom:20px}
.label{display:block;font-weight:600;margin-bottom:8px;color:var(--t)}
.input{width:100%;padding:10px 12px;border:2px solid var(--b);border-radius:var(--r);font-size:14px}
.input:focus{outline:none;border-color:var(--p)}
.number-control{display:flex;align-items:center;gap:10px}
.number-input{display:flex;align-items:center;border:2px solid var(--b);border-radius:var(--r);overflow:hidden}
.number-btn{background:var(--l);border:none;padding:12px 16px;font-size:18px;font-weight:600;cursor:pointer;color:var(--s);min-width:48px}
.number-btn:hover{background:var(--p);color:var(--w)}
.number-display{padding:12px 20px;font-size:18px;font-weight:600;min-width:60px;text-align:center;border:none;color:var(--p)}
.grid-2{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px}
.grid-3{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px}
.chip{padding:8px 12px;border:2px solid var(--b);border-radius:20px;background:var(--w);cursor:pointer;text-align:center;font-size:13px;user-select:none}
.chip:hover{border-color:var(--p)}
.chip.selected{background:var(--p);color:var(--w);border-color:var(--p)}
.constraint-box{background:var(--l);border:2px solid var(--b);border-radius:var(--r);padding:20px;margin-bottom:20px}
.constraint-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
.constraint-item{background:var(--w);border:1px solid var(--b);border-radius:var(--r);padding:12px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
.time-picker{padding:8px 12px;border:2px solid var(--b);border-radius:var(--r);font-size:16px;font-weight:600;color:var(--p);background:var(--w)}
.time-picker:focus{outline:none;border-color:var(--p)}
.time-picker-wrapper{display:flex;align-items:center;gap:15px;background:var(--l);padding:12px;border-radius:var(--r);border:2px solid var(--b)}
.time-display{font-size:14px;color:var(--s);font-weight:500}
.time-buttons{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
.time-btn{padding:8px 16px;border:2px solid var(--b);background:var(--w);border-radius:var(--r);cursor:pointer;font-size:14px;font-weight:500;transition:all 0.2s}
.time-btn:hover{border-color:var(--p);background:var(--l)}
.time-btn.active{background:var(--p);color:var(--w);border-color:var(--p)}
.alert{padding:16px;border-radius:var(--r);margin-bottom:20px;font-weight:500}
.alert-success{background:#d1fae5;color:#065f46;border:1px solid #34d399}
.alert-warning{background:#fef3c7;color:#92400e;border:1px solid #fbbf24}
.alert-danger{background:#fee2e2;color:#991b1b;border:1px solid #f87171}
.round{background:var(--w);border-radius:var(--r);padding:20px;margin-bottom:15px;box-shadow:var(--sh)}
.round-title{font-size:1.2rem;font-weight:600;color:var(--p);margin-bottom:15px;text-align:center}
.groups{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px}
.group{background:linear-gradient(135deg,var(--l),#e2e8f0);border-radius:var(--r);padding:15px;border:2px solid var(--b)}
.group-header{font-weight:600;color:var(--p);margin-bottom:10px}
.group-members{display:flex;flex-wrap:wrap;gap:6px}
.member{background:var(--p);color:var(--w);padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500}
.stats{background:var(--w);border-radius:var(--r);padding:20px;margin-top:15px;box-shadow:var(--sh)}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin-top:15px}
.stat{text-align:center;background:var(--l);padding:15px;border-radius:var(--r);border:2px solid var(--b)}
.stat-value{font-size:1.5rem;font-weight:700;color:var(--p)}
.stat-label{color:var(--s);font-size:12px;margin-top:5px}
.tab-bar{background:var(--w);border-radius:var(--r);box-shadow:var(--sh);margin-bottom:15px;padding:15px}
.tab-btn{display:inline-block;padding:8px 16px;margin-right:8px;border:1px solid var(--b);background:var(--w);color:var(--s);border-radius:4px;cursor:pointer;transition:all 0.2s;font-size:13px}
.tab-btn:hover{background:var(--l);border-color:var(--p)}
.tab-btn.active{background:var(--p);color:var(--w);border-color:var(--p)}
.table-container{flex:1;overflow:hidden;background:var(--w);border-radius:var(--r);box-shadow:var(--sh);min-height:400px;display:flex;flex-direction:column;position:relative}
.table-wrapper{flex:1;overflow:auto;position:relative}
.table{width:100%;border-collapse:collapse;font-size:13px;min-width:800px}
.table th{background:var(--l);border:1px solid var(--b);padding:0;text-align:left;font-weight:600;position:sticky;top:0;z-index:10;white-space:nowrap;vertical-align:top}
.table td{border:1px solid var(--b);padding:8px;background:var(--w);vertical-align:top}
.table tbody tr:hover td{background:#f1f3f4}
.table tbody tr:nth-child(even){background:#f9f9f9}
.ch{display:flex;flex-direction:column;width:100%}
.ct{padding:8px 12px;font-weight:600;border-bottom:1px solid var(--b);background:var(--l);font-size:12px}
.cc{padding:4px 8px;display:flex;gap:4px;justify-content:center;background:#f1f3f4;border-bottom:1px solid var(--b)}
.cb2{background:rgba(0,123,255,0.1);border:1px solid var(--p);color:var(--p);cursor:pointer;padding:2px 6px;border-radius:3px;font-size:11px;font-weight:600;transition:all 0.2s;min-width:20px;height:20px;display:flex;align-items:center;justify-content:center}
.cb2:hover,.cb2.active{background:var(--p);color:var(--w)}
.sb{background:rgba(40,167,69,0.1);border:1px solid var(--g);color:var(--g)}
.sb:hover,.sb.active{background:var(--g);color:var(--w)}
.fd{position:absolute;top:100%;left:0;background:var(--w);border:1px solid #ced4da;border-radius:4px;box-shadow:0 4px 12px rgba(0,0,0,0.15);max-height:300px;overflow-y:auto;z-index:1000;display:none;min-width:250px;margin-top:2px}
.fh{padding:10px;border-bottom:1px solid var(--b);background:var(--l)}
.fs{width:100%;border:1px solid #ced4da;border-radius:4px;padding:6px 8px;font-size:12px}
.fi{padding:8px 12px;cursor:pointer;border-bottom:1px solid #f1f1f1;font-size:13px;user-select:none}
.fi:hover{background:var(--l)}
.fi label{display:flex;align-items:center;cursor:pointer;width:100%}
.fi input[type="checkbox"]{margin-right:8px;accent-color:var(--p)}
.sa{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
.si{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
.sb2{display:inline-block;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:600;text-transform:uppercase}
.tpb{background:rgba(108,117,125,0.1);border:1px solid var(--s);color:var(--s);cursor:pointer;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:600;transition:all 0.2s;margin-left:10px}
.tpb:hover,.tpb.active{background:var(--s);color:var(--w)}
.section-title{font-size:1.1rem;font-weight:600;color:var(--p);margin-bottom:15px;display:flex;align-items:center;gap:8px}
.hidden{display:none!important}
.text-center{text-align:center}
.text-muted{color:var(--m)}
.flex{display:flex}
.flex-col{flex-direction:column}
.gap-2{gap:8px}
.gap-3{gap:12px}
.justify-between{justify-content:space-between}
.items-center{align-items:center}
.mb-2{margin-bottom:8px}
.mb-3{margin-bottom:12px}
.mt-2{margin-top:8px}
.mt-3{margin-top:12px}
.w-full{width:100%}
.empty-state{text-align:center;padding:40px;color:var(--s)}
@media (max-width:768px){
body{padding:5px}
.header{padding:15px;margin-bottom:10px}
.header h1{font-size:20px!important;margin-bottom:5px}
.header p{font-size:13px}
.gnb{flex-wrap:wrap;gap:5px;margin-top:10px}
.gnb-btn{padding:10px 16px;font-size:13px}
.content{flex-direction:column;gap:10px}
.sidebar{width:100%}
.main-area{padding:10px}
.card{margin-bottom:10px}
.card-body{padding:12px}
.section-title{font-size:16px;margin-bottom:12px}
.upload-zone{padding:20px}
.upload-zone svg{width:20px;height:20px}
.tab-bar{padding:10px;margin-bottom:10px}
.tab-btn{margin-right:4px;margin-bottom:4px;padding:6px 10px;font-size:11px;white-space:nowrap}
.btn{padding:6px 12px;font-size:12px}
.tpb{margin-left:0;margin-top:5px;padding:6px 10px;font-size:11px}
.flex.justify-between.items-center.mb-2{flex-direction:column;align-items:stretch;gap:8px}
.flex.gap-2{flex-wrap:wrap}
.table-container{min-height:250px}
.table{font-size:11px;min-width:600px}
.table th{padding:6px 4px}
.table td{padding:6px 4px}
.ch .ct{padding:6px 8px;font-size:11px}
.ch .cc{padding:3px 4px}
.cb2{min-width:18px;height:18px;font-size:10px;padding:1px 4px}
.fd{min-width:200px;font-size:11px}
.fi{padding:6px 8px;font-size:11px}
.fs{padding:4px 6px;font-size:11px}
.groups{grid-template-columns:1fr}
.stats-grid{grid-template-columns:repeat(2,1fr)}
.grid-2{grid-template-columns:1fr}
.grid-3{grid-template-columns:repeat(2,1fr)}
.number-control{flex-direction:column;align-items:stretch;gap:8px}
.number-input{justify-content:center}
.time-picker-wrapper{flex-direction:column;gap:8px;align-items:stretch}
.time-buttons{justify-content:center;gap:4px}
.time-btn{padding:6px 12px;font-size:12px}
.constraint-box{padding:15px;margin-bottom:15px}
.constraint-header{flex-direction:column;align-items:stretch;gap:8px}
.chip{padding:6px 8px;font-size:11px}
.round{padding:15px;margin-bottom:10px}
.round-title{font-size:16px;margin-bottom:10px}
.group{padding:12px}
.group-header{font-size:14px;margin-bottom:8px}
.member{padding:3px 6px;font-size:11px}
.stats{padding:15px;margin-top:10px}
.stat{padding:12px}
.stat-value{font-size:1.2rem}
.stat-label{font-size:11px}
}
</style>
</head>
<body>
<div class="main-container">
<div class="header">
<h1>ì¹´í†¡ ëŒ€í™” ë¶„ì„ ë° ê°„í¸ ê·¸ë£¹ ë°°ì¹˜ ì‹œìŠ¤í…œ</h1>
<p style="color:var(--m);margin:0">ì¹´ì¹´ì˜¤í†¡ ëŒ€í™” ë¡œê·¸ ì‚¬ìš©ì ë¶„ì„ / ê°„í¸ ê·¸ë£¹ ë°°ì¹˜ ì„œë¹„ìŠ¤</p>
<div class="gnb">
<button class="gnb-btn active" data-page="kakao" onclick="switchPage('kakao')">ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ ë¶„ì„</button>
<button class="gnb-btn" data-page="group" onclick="switchPage('group')">ê°„í¸ ê·¸ë£¹ ë°°ì¹˜</button>
</div>
</div>

<!-- ì¹´ì¹´ì˜¤í†¡ ë¶„ì„ í˜ì´ì§€ -->
<div id="kakaoPage" class="content">
<div class="sidebar">
<div class="card">
<div class="card-body" style="display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:180px">
<h3 style="font-size:18px;font-weight:bold;color:var(--t);margin-bottom:8px">ğŸ“ íŒŒì¼ ì—…ë¡œë“œ</h3>
<p style="font-size:14px;font-weight:600;color:#374151;margin-bottom:16px">(í•¸ë“œí° ë‚´ë³´ë‚´ê¸° íŒŒì¼ë§Œ ê°€ëŠ¥)</p>
<div class="upload-zone" id="kt_uploadZone">
<input type="file" id="kt_fileInput" accept=".txt,.eml,text/plain,message/rfc822" style="display:none">
<svg viewBox="0 0 16 16" fill="currentColor">
<path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
<path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
</svg>
<div style="color:#374151;font-weight:500">íŒŒì¼ ë“œë˜ê·¸ ë˜ëŠ” í´ë¦­</div>
<div style="color:var(--m);font-size:12px">(.txt, .eml)</div>
</div>
<div id="kt_fileName" class="mt-2 text-muted hidden" style="font-size:12px"></div>
</div>
</div>
<div id="kt_messageStats" class="card hidden">
<div class="card-body" style="min-height:180px">
<h3 style="font-size:18px;font-weight:bold;color:var(--t);margin-bottom:16px">ğŸ“Š ë©”ì‹œì§€ í†µê³„</h3>
<div style="display:flex;flex-direction:column;gap:8px">
<div class="flex justify-between">
<span style="color:var(--m)">ì´ ë©”ì‹œì§€:</span>
<span id="kt_messageCount" style="font-weight:700;color:var(--p)">0</span>
</div>
<div class="flex justify-between">
<span style="color:var(--m)">í™œë™ ì‚¬ìš©ì:</span>
<span id="kt_activeUserCount" style="font-weight:700;color:var(--g)">0</span>
</div>
<div class="flex justify-between">
<span style="color:var(--m)">ì´ ì‚¬ìš©ì:</span>
<span id="kt_totalUserCount" style="font-weight:700;color:var(--m)">0</span>
</div>
</div>
<button id="kt_downloadMessagesBtn" class="btn btn-primary w-full mt-3">ì „ì²´ ë©”ì‹œì§€ CSV ë‹¤ìš´ë¡œë“œ</button>
</div>
</div>
</div>

<div class="main-area">
<div id="kt_tabControlBar" class="tab-bar hidden">
<div class="flex justify-between items-center mb-2">
<div>
<label style="font-size:18px;font-weight:bold;color:var(--t)">ë°ì´í„°ì…‹ ì„ íƒ</label>
<div style="font-size:12px;margin-top:4px;color:var(--m)">
<div style="color:#dc3545">â€¢ ëª¨ë“  ë°ì´í„°ëŠ” ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ íŒŒì¼ì˜ ì²« ë©”ì‹œì§€ ì‹œì‘ ì‹œì ì„ ê¸°ì¤€ìœ¼ë¡œ ì‚°ì¶œë©ë‹ˆë‹¤</div>
<div style="color:#dc3545">â€¢ ì „ì²´ ë©”ì‹œì§€ëŠ” ì§ì ‘ íƒ­ì— ë“¤ì–´ê°€ì„œ í•„í„°ë¥¼ ì ìš©í•˜ì—¬ í•„ìš”í•œ ë°ì´í„°ë§Œ í™•ì¸ í•˜ì‹œê¸¸ ê¶Œì¥í•©ë‹ˆë‹¤</div>
<div>â€¢ í˜„ì¬ í†¡ë°©ì— ìˆëŠ”ë° í˜„ì¬ í™œë™ì ë¦¬ìŠ¤íŠ¸ì— ì—†ëŠ” ìœ ì €ì˜ ê²½ìš°, ìµœê·¼ 2ë‹¬ê°„ ì±„íŒ…ì„ í•˜ì§€ ì•Šì€ ìœ ì €ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
<div>â€¢ í˜„ì¬ í†¡ë°©ì— ì—†ìœ¼ë‚˜ í˜„ì¬ í™œë™ì ë¦¬ìŠ¤íŠ¸ì— ìˆëŠ” ìœ ì €ì˜ ê²½ìš°, ê´€ë¦¬ìê°€ í•´ë‹¹ ìœ ì €ì˜ í‡´ì¥ ê¸°ë¡ì„ ì‚­ì œí•˜ì—¬ ì¶”ì ì´ ë¶ˆê°€ëŠ¥í•˜ê²Œ ëœ ê²½ìš°ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° 2ë‹¬ì´ ì§€ë‚˜ë©´ ìë™ìœ¼ë¡œ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì‚­ì œë©ë‹ˆë‹¤</div>
</div>
<div class="mt-2">
<button class="tab-btn active" data-tab="active" onclick="kt_switchTab('active')">í˜„ì¬ í™œë™ì (<span id="kt_activeCount">0</span>)</button>
<button class="tab-btn" data-tab="inactive" onclick="kt_switchTab('inactive')">ìµœê·¼ ë¹„í™œë™ì(2ê°œì›”ê°„, ì±„íŒ…ê¸°ì¤€) (<span id="kt_inactiveCount">0</span>)</button>
<button class="tab-btn" data-tab="summary" onclick="kt_switchTab('summary')">ì‚¬ìš©ì ìš”ì•½ (<span id="kt_summaryCount">0</span>)</button>
<button class="tab-btn" data-tab="messages" onclick="kt_switchTab('messages')">ì „ì²´ ë©”ì‹œì§€ (<span id="kt_filteredMessageCount">0</span>)</button>
</div>
</div>
<div class="flex gap-2">
<button id="kt_transposeBtn" class="tpb hidden">
<svg fill="currentColor" viewBox="0 0 16 16" style="width:14px;height:14px;margin-right:4px">
<path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1h8zm-7.978-1A.261.261 0 0 1 7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002a.274.274 0 0 1-.014.002H7.022zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
</svg>
í–‰/ì—´ ì „í™˜
</button>
<button id="kt_downloadBtn" class="btn btn-success">ê²°ê³¼ ë‹¤ìš´ë¡œë“œ</button>
<button id="kt_clearFilters" class="btn btn-secondary">í•„í„° ì´ˆê¸°í™”</button>
</div>
</div>
</div>

<div class="table-container">
<div id="kt_guideSection">
<!-- ì¹´ì¹´ì˜¤í†¡ ë‚´ë³´ë‚´ê¸° ê°€ì´ë“œ ì»´í¬ë„ŒíŠ¸ -->
<div id="kakao-export-guide-component" style="font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;width:100%;margin:20px 0;box-sizing:border-box;background:transparent;position:relative;z-index:1">
<h2 style="text-align:center;margin-bottom:20px;color:var(--t);font-size:20px">ğŸ“± íŒŒì¼ ì—…ë¡œë“œìš© ëŒ€í™” íŒŒì¼ ë‚´ë³´ë‚´ê¸° ê°€ì´ë“œ</h2>
<style>
/* ì™„ì „íˆ ë…ë¦½ì ì¸ ìŠ¤íƒ€ì¼ - ì™¸ë¶€ CSSì™€ ì¶©ëŒ ë°©ì§€ */
#kakao-export-guide-component,#kakao-export-guide-component *{box-sizing:border-box;margin:0;padding:0}
#kakao-export-guide-component{color:#333;line-height:normal;font-size:14px;text-align:left}
#kakao-export-guide-component .guide-timeline{display:flex;gap:clamp(15px,3vw,30px);padding:20px;overflow-x:auto;width:100%;background:transparent;-webkit-overflow-scrolling:touch;scrollbar-width:thin}
#kakao-export-guide-component .guide-step{border:1px solid #ddd;border-radius:8px;padding:clamp(15px,3vw,25px);width:clamp(180px,18vw,220px);flex-shrink:0;background:#fff;position:relative;min-width:180px}
#kakao-export-guide-component .step-number{display:flex;align-items:center;justify-content:center;width:30px;height:30px;background:#333;color:#fff;border-radius:50%;font-weight:bold;margin:0 auto 15px;font-size:14px}
#kakao-export-guide-component .step-title{font-size:clamp(0.9rem,2.2vw,1.1rem);font-weight:bold;color:#333;margin-bottom:10px;text-align:center;line-height:1.3}
#kakao-export-guide-component .step-desc{color:#666;line-height:1.4;margin-bottom:15px;text-align:center;font-size:clamp(0.7rem,1.8vw,0.85rem)}
#kakao-export-guide-component .phone-mockup{width:clamp(100px,12vw,140px);height:clamp(200px,24vw,280px);border:2px solid #333;border-radius:15px;margin:0 auto;padding:clamp(8px,1.5vw,12px);background:#1a1a1a}
#kakao-export-guide-component .phone-screen{width:100%;height:100%;border:1px solid #ccc;border-radius:8px;overflow:hidden;position:relative;background:#fff}
#kakao-export-guide-component .status-bar{height:clamp(15px,2.5vw,18px);background:#f5f5f5;display:flex;justify-content:space-between;align-items:center;padding:0 8px;font-size:clamp(7px,1.3vw,9px);border-bottom:1px solid #ddd;color:#333}
#kakao-export-guide-component .header-bar{height:clamp(30px,5vw,40px);background:#f0f0f0;display:flex;align-items:center;justify-content:space-between;padding:0 10px;border-bottom:1px solid #ddd}
#kakao-export-guide-component .header-btn{width:clamp(14px,2.5vw,18px);height:clamp(14px,2.5vw,18px);border:1px solid #333;display:flex;align-items:center;justify-content:center;font-size:clamp(8px,1.5vw,10px);color:#333;border-radius:2px;background:#fff}
#kakao-export-guide-component .header-title{font-weight:600;font-size:clamp(8px,1.8vw,10px);color:#333}
#kakao-export-guide-component .screen-content{padding:clamp(8px,2vw,12px);height:calc(100% - 50px);overflow:hidden}
#kakao-export-guide-component .menu-item{padding:clamp(6px,1.5vw,8px) 0;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;font-size:clamp(6px,1.5vw,8px);color:#333}
#kakao-export-guide-component .menu-highlight{background:#fffacd;border:1px solid #ffd700;border-radius:4px;padding:clamp(4px,1vw,6px);margin:clamp(4px,1vw,6px) 0}
#kakao-export-guide-component .export-area{padding:clamp(6px,1.5vw,8px)}
#kakao-export-guide-component .export-option{background:#fffacd;border:1px solid #ffd700;border-radius:4px;padding:clamp(6px,1.5vw,8px);margin-bottom:clamp(6px,1.5vw,8px);text-align:center}
#kakao-export-guide-component .option-title{font-weight:bold;color:#333;font-size:clamp(6px,1.5vw,8px)}
#kakao-export-guide-component .option-desc{font-size:clamp(5px,1.2vw,6px);color:#666;margin-top:2px}
#kakao-export-guide-component .file-item{background:#f5f5f5;border:1px solid #ddd;border-radius:4px;padding:clamp(6px,1.5vw,8px);margin:clamp(4px,1vw,6px) 0;display:flex;align-items:center;gap:6px}
#kakao-export-guide-component .file-icon{width:clamp(16px,3vw,20px);height:clamp(16px,3vw,20px);background:#666;border-radius:3px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold;font-size:clamp(5px,1.2vw,7px)}
#kakao-export-guide-component .file-name{font-weight:600;color:#333;font-size:clamp(6px,1.5vw,8px)}
#kakao-export-guide-component .share-area{display:flex;justify-content:space-around;padding:clamp(6px,1.5vw,8px) 0}
#kakao-export-guide-component .share-btn{display:flex;flex-direction:column;align-items:center;gap:3px;text-decoration:none;color:#333;font-size:clamp(5px,1.2vw,7px)}
#kakao-export-guide-component .share-icon{width:clamp(16px,3vw,20px);height:clamp(16px,3vw,20px);border:1px solid #333;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#333;font-size:clamp(6px,1.5vw,8px);background:#fff}
#kakao-export-guide-component .highlight-btn{border:2px solid #ffd700!important}
@media(max-width:768px){
#kakao-export-guide-component .guide-timeline{gap:8px;padding:15px 10px;overflow-x:auto;-webkit-overflow-scrolling:touch}
#kakao-export-guide-component .guide-step{width:280px;min-width:280px;padding:15px;margin:0}
#kakao-export-guide-component .phone-mockup{width:120px;height:240px;margin:0 auto;padding:8px}
#kakao-export-guide-component .phone-screen{border-radius:6px}
#kakao-export-guide-component .status-bar{height:16px;font-size:8px;padding:0 6px}
#kakao-export-guide-component .header-bar{height:32px;padding:0 8px}
#kakao-export-guide-component .header-btn{width:16px;height:16px;font-size:9px}
#kakao-export-guide-component .header-title{font-size:9px}
#kakao-export-guide-component .screen-content{padding:8px}
#kakao-export-guide-component .menu-item{font-size:7px;padding:4px 0}
#kakao-export-guide-component .menu-highlight{padding:4px;margin:3px 0}
#kakao-export-guide-component .export-area{padding:6px}
#kakao-export-guide-component .export-option{padding:6px;margin-bottom:6px}
#kakao-export-guide-component .option-title{font-size:7px}
#kakao-export-guide-component .option-desc{font-size:6px}
#kakao-export-guide-component .file-item{padding:4px;margin:3px 0;gap:4px}
#kakao-export-guide-component .file-icon{width:16px;height:16px;font-size:6px}
#kakao-export-guide-component .file-name{font-size:7px}
#kakao-export-guide-component .share-area{padding:4px 0}
#kakao-export-guide-component .share-btn{font-size:6px;gap:2px}
#kakao-export-guide-component .share-icon{width:16px;height:16px;font-size:7px}
#kakao-export-guide-component .step-title{font-size:14px;line-height:1.2;margin-bottom:8px}
#kakao-export-guide-component .step-desc{font-size:12px;line-height:1.3;margin-bottom:12px}
#kakao-export-guide-component .step-number{width:24px;height:24px;font-size:12px;margin-bottom:10px}
}
</style>
<div class="guide-timeline">
<div class="guide-step">
<div class="step-number">1</div>
<div class="step-title">ë©”ë‰´ ë²„íŠ¼ ì„ íƒ</div>
<div class="step-desc">ì±„íŒ…ë°© ìš°ìƒë‹¨ì˜ ë©”ë‰´ ë²„íŠ¼(â‰¡)ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
<div class="phone-mockup">
<div class="phone-screen">
<div class="status-bar"><span>KT 2:49</span><span>ğŸ”‹81</span></div>
<div class="header-bar">
<div class="header-btn">â†</div>
<div class="header-title">ì±„íŒ…ë°©</div>
<div class="header-btn highlight-btn">â‰¡</div>
</div>
<div class="screen-content" style="display:flex;align-items:center;justify-content:center">
<div style="text-align:center"><div style="font-size:14px;margin-bottom:6px">ğŸ’¬</div><div style="font-size:8px">ì±„íŒ…ë°© í™”ë©´</div></div>
</div>
</div>
</div>
</div>
<div class="guide-step">
<div class="step-number">2</div>
<div class="step-title">ì„¤ì • ë©”ë‰´ ì§„ì…</div>
<div class="step-desc">ìš°ì¸¡ ìƒë‹¨ í†±ë‹ˆë°”í€´ ëª¨ì–‘ì˜ ì„¤ì • ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì±„íŒ…ë°© ì„¤ì • í™”ë©´ìœ¼ë¡œ ì§„ì…í•´ì£¼ì„¸ìš”</div>
<div class="phone-mockup">
<div class="phone-screen">
<div class="status-bar"><span>KT 2:49</span><span>ğŸ”‹81</span></div>
<div class="header-bar">
<div class="header-btn">â†</div>
<div class="header-title">ë©”ë‰´</div>
<div class="header-btn highlight-btn">âš™</div>
</div>
<div class="screen-content">
<div class="menu-item menu-highlight"><div style="font-weight:bold">ì±„íŒ…ë°© ì„¤ì •</div><div>â†’</div></div>
<div class="menu-item"><div>ì±„íŒ…ë°© ë‚˜ê°€ê¸°</div><div>â†’</div></div>
</div>
</div>
</div>
</div>
<div class="guide-step">
<div class="step-number">3</div>
<div class="step-title">ë‚´ë³´ë‚´ê¸° ë©”ë‰´</div>
<div class="step-desc">"ëŒ€í™” ë‚´ìš© ë‚´ë³´ë‚´ê¸°"ë¥¼ ì°¾ì•„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
<div class="phone-mockup">
<div class="phone-screen">
<div class="status-bar"><span>KT 2:49</span><span>ğŸ”‹81</span></div>
<div class="header-bar">
<div class="header-btn">â†</div>
<div class="header-title">ì±„íŒ…ë°© ì„¤ì •</div>
<div></div>
</div>
<div class="screen-content">
<div class="menu-item"><div>í˜„ì¬ ì±„íŒ…ë°© ë°°ê²½í™”ë©´</div></div>
<div class="menu-item"><div>í˜„ì¬ ì±„íŒ…ë°© ì•Œë¦¼ìŒ</div></div>
<div class="menu-item menu-highlight"><div style="font-weight:bold">ëŒ€í™” ë‚´ìš© ë‚´ë³´ë‚´ê¸°</div><div>â†’</div></div>
</div>
</div>
</div>
</div>
<div class="guide-step">
<div class="step-number">4</div>
<div class="step-title">ì €ì¥ ë°©ì‹ ì„ íƒ</div>
<div class="step-desc">"í…ìŠ¤íŠ¸ ë©”ì‹œì§€ë§Œ ì €ì¥" ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
<div class="phone-mockup">
<div class="phone-screen">
<div class="status-bar"><span>KT 2:49</span><span>ğŸ”‹81</span></div>
<div class="header-bar">
<div class="header-btn">â†</div>
<div class="header-title" style="font-size:8px">ëŒ€í™” ë‚´ìš© ë‚´ë³´ë‚´ê¸°</div>
<div></div>
</div>
<div class="export-area">
<div class="export-option">
<div class="option-title">í…ìŠ¤íŠ¸ ë©”ì‹œì§€ë§Œ ì €ì¥</div>
<div class="option-desc">í…ìŠ¤íŠ¸ë§Œ íŒŒì¼ë¡œ ì „ì†¡</div>
</div>
<div style="padding:6px;border:1px solid #ddd;border-radius:4px">
<div style="font-weight:bold;margin-bottom:3px;font-size:6px">ëª¨ë“  ë©”ì‹œì§€ ì €ì¥</div>
<div style="font-size:5px;color:#666">ì‚¬ì§„, ë™ì˜ìƒ í¬í•¨ ì €ì¥</div>
</div>
</div>
</div>
</div>
</div>
<div class="guide-step">
<div class="step-number">5</div>
<div class="step-title">íŒŒì¼ íšë“ ë° ì—…ë¡œë“œ</div>
<div class="step-desc">ìƒì„±ëœ íŒŒì¼(txt ë˜ëŠ” eml)ì„ íšë“ í›„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</div>
<div class="phone-mockup">
<div class="phone-screen">
<div class="status-bar"><span>KT 2:49</span><span>ğŸ”‹81</span></div>
<div class="header-bar">
<div class="header-btn">â†</div>
<div class="header-title" style="font-size:8px">ëŒ€í™” ë‚´ìš© ë‚´ë³´ë‚´ê¸°</div>
<div></div>
</div>
<div class="screen-content">
<div style="text-align:center;margin-bottom:10px;font-weight:bold;font-size:8px">í•­ëª© 1ê°œ</div>
<div class="file-item">
<div class="file-icon">TXT</div>
<div class="file-name">KakaoTalkChats.txt</div>
</div>
<div class="share-area">
<a href="#" class="share-btn">
<div class="share-icon">ğŸ“</div>
<span>Drive</span>
</a>
<a href="#" class="share-btn">
<div class="share-icon">ğŸ“§</div>
<span>Signal</span>
</a>
<a href="#" class="share-btn">
<div class="share-icon">âœ‰</div>
<span>Gmail</span>
</a>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- ì¹´ì¹´ì˜¤í†¡ ë‚´ë³´ë‚´ê¸° ê°€ì´ë“œ ì»´í¬ë„ŒíŠ¸ ë -->
</div>

<div style="position:sticky;bottom:0;left:0;right:0;height:12px;background:var(--l);border-top:1px solid var(--b);overflow-x:auto;overflow-y:hidden;z-index:20;display:none" id="kt_horizontalScrollbar">
<div style="height:1px;width:100%;min-width:800px" id="kt_horizontalScrollbarContent"></div>
</div>

<div class="table-wrapper hidden" id="kt_tableWrapper">
<table class="table">
<thead><tr id="kt_tableHeader"></tr></thead>
<tbody id="kt_tableBody"></tbody>
</table>
</div>
</div>
</div>
</div>

<!-- ê·¸ë£¹ ë°°ì¹˜ í˜ì´ì§€ -->
<div id="groupPage" class="content hidden">
<div class="sidebar">
<div class="card">
<div class="card-body">
<h3 class="section-title">ğŸ‘¥ ì°¸ì„ì ì„¤ì •</h3>
<div class="form-group">
<label class="label">ì°¸ì„ì ìˆ˜</label>
<div class="number-control">
<div class="number-input">
<button class="number-btn" onclick="gp_adjust('participants',-1)">âˆ’</button>
<input type="number" class="number-display" id="gp_participantsCount" value="8" min="2" max="50">
<button class="number-btn" onclick="gp_adjust('participants',1)">+</button>
</div>
</div>
</div>
<div class="form-group">
<label class="label">ì°¸ì„ìëª…</label>
<div class="grid-2" id="gp_participantsGrid"></div>
</div>
</div>
</div>

<div class="card">
<div class="card-body">
<h3 class="section-title">ğŸ·ï¸ ê·¸ë£¹ ì„¤ì •</h3>
<div class="form-group">
<label class="label">ê·¸ë£¹ ìˆ˜</label>
<div class="number-control">
<div class="number-input">
<button class="number-btn" onclick="gp_adjust('groups',-1)">âˆ’</button>
<input type="number" class="number-display" id="gp_groupsCount" value="2" min="1" max="25">
<button class="number-btn" onclick="gp_adjust('groups',1)">+</button>
</div>
</div>
</div>
<div class="form-group">
<label class="label">ê·¸ë£¹ ì´ë¦„</label>
<div class="grid-2" id="gp_groupNamesGrid"></div>
</div>
</div>
</div>

<div class="card">
<div class="card-body">
<h3 class="section-title">â° ë°°ì¹˜ ì„¤ì •</h3>
<div class="form-group">
<label class="label">ë°°ì¹˜ íšŸìˆ˜</label>
<div class="number-control">
<div class="number-input">
<button class="number-btn" onclick="gp_adjust('rounds',-1)">âˆ’</button>
<input type="number" class="number-display" id="gp_roundsCount" value="3" min="1" max="20">
<button class="number-btn" onclick="gp_adjust('rounds',1)">+</button>
</div>
</div>
</div>
<div class="form-group">
<label class="label">ë°°ì¹˜ ì‹œì‘ ì‹œê°„</label>
<div class="time-picker-wrapper">
<input type="time" class="time-picker" id="gp_startTimePicker" value="09:00">
<div class="time-display">
<span id="gp_startTimeDisplay">ì‹œì‘: 09:00</span>
</div>
</div>
</div>
<div class="form-group">
<label class="label">ë°°ì¹˜ ì‹œê°„ ê°„ê²©</label>
<div class="time-buttons">
<button class="time-btn" data-minutes="30" onclick="gp_setTime(30)">30ë¶„</button>
<button class="time-btn active" data-minutes="45" onclick="gp_setTime(45)">45ë¶„</button>
<button class="time-btn" data-minutes="60" onclick="gp_setTime(60)">60ë¶„</button>
<button class="time-btn" data-minutes="90" onclick="gp_setTime(90)">90ë¶„</button>
<button class="time-btn" data-minutes="120" onclick="gp_setTime(120)">120ë¶„</button>
</div>
<div style="margin-top:8px;font-size:12px;color:var(--m)">
<span id="gp_intervalDisplay">ì„ íƒëœ ê°„ê²©: 45ë¶„</span>
</div>
</div>
</div>
</div>
</div>

<div class="main-area">
<div class="card">
<div class="card-body">
<h3 class="section-title">ğŸš« ì˜ˆì™¸ ì¡°ê±´ ì„¤ì •</h3>
<div class="constraint-box">
<div class="constraint-header">
<div style="font-weight:600">ğŸ”´ ë¶„ë¦¬ ëŒ€ìƒ</div>
<button class="btn btn-danger btn-sm" onclick="gp_showConstraintSelector('separation')">ì¶”ê°€</button>
</div>
<div style="font-size:12px;color:var(--m);margin-bottom:15px">ì„ íƒëœ ì°¸ì„ìë“¤ì€ ëª¨ë“  ë°°ì¹˜ì—ì„œ ì ˆëŒ€ ê°™ì€ ê·¸ë£¹ì— ë°°ì¹˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
<div id="gp_separationSelector" class="hidden">
<div class="grid-3" id="gp_separationParticipants"></div>
<div class="flex gap-2 mt-2">
<button class="btn btn-primary btn-sm" onclick="gp_confirmConstraint('separation')">í™•ì¸</button>
<button class="btn btn-secondary btn-sm" onclick="gp_hideConstraintSelector('separation')">ì·¨ì†Œ</button>
</div>
</div>
<div id="gp_separationConstraints"></div>
</div>

<div class="constraint-box">
<div class="constraint-header">
<div style="font-weight:600">ğŸ”µ ì„¸íŠ¸ ëŒ€ìƒ</div>
<button class="btn btn-primary btn-sm" onclick="gp_showConstraintSelector('set')">ì¶”ê°€</button>
</div>
<div style="font-size:12px;color:var(--m);margin-bottom:15px">ì„ íƒëœ ì°¸ì„ìë“¤ì€ ìµœì†Œ í•œ ë²ˆì€ ê°™ì€ ê·¸ë£¹ì— ë°°ì¹˜ë©ë‹ˆë‹¤.</div>
<div id="gp_setSelector" class="hidden">
<div class="grid-3" id="gp_setParticipants"></div>
<div class="flex gap-2 mt-2">
<button class="btn btn-primary btn-sm" onclick="gp_confirmConstraint('set')">í™•ì¸</button>
<button class="btn btn-secondary btn-sm" onclick="gp_hideConstraintSelector('set')">ì·¨ì†Œ</button>
</div>
</div>
<div id="gp_setConstraints"></div>
</div>

<div class="text-center mt-3">
<button class="btn btn-success btn-lg" onclick="gp_generate()">ğŸš€ ê·¸ë£¹ ë°°ì¹˜ ì‹¤í–‰</button>
</div>
</div>
</div>

<div class="hidden" id="gp_resultsSection">
<div id="gp_alertContainer"></div>
<div class="text-center mb-3">
<button class="btn btn-primary" onclick="gp_copyText()">ğŸ“‹ í…ìŠ¤íŠ¸ë¡œ ë³µì‚¬</button>
</div>
<div id="gp_resultsContainer"></div>
<div class="stats">
<h3 style="text-align:center;color:var(--p);margin-bottom:10px">ğŸ“Š ë°°ì¹˜ í†µê³„</h3>
<div class="stats-grid" id="gp_statsGrid"></div>
</div>
</div>
</div>
</div>
</div>

<script>
// ì¹´ì¹´ì˜¤í†¡ ë¶„ì„ ê´€ë ¨ ë³€ìˆ˜
const kt_state={data:{messages:[],summary:[],active:[],inactive:[]},filtered:{messages:[],summary:[],active:[],inactive:[]},currentTab:'active',filters:{},sorts:{},transpose:{}};

// ê·¸ë£¹ ë°°ì¹˜ ê´€ë ¨ ë³€ìˆ˜
let gp_participants=[],gp_groupNames=[],gp_timeInterval=45,gp_startTime='09:00',gp_separationConstraints=[],gp_setConstraints=[],gp_results=[];

// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
const kt_utils={
parseTime(timeStr){try{const converted=timeStr.replace('ì˜¤ì „','AM').replace('ì˜¤í›„','PM');const match=converted.match(/(\d{4})ë…„ (\d{1,2})ì›” (\d{1,2})ì¼ (AM|PM) (\d{1,2}):(\d{2})/);if(!match)return null;const[,year,month,day,ampm,hour,minute]=match;let hour24=parseInt(hour);if(ampm==='PM'&&hour24!==12)hour24+=12;if(ampm==='AM'&&hour24===12)hour24=0;return `${year}-${month.padStart(2,'0')}-${day.padStart(2,'0')} ${hour24.toString().padStart(2,'0')}:${minute.padStart(2,'0')}:00`}catch{return null}},
downloadCSV(data,filename){
if(!data||data.length===0){alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');return}
try{
let csvContent='';
const headers=Object.keys(data[0]);
csvContent+=headers.map(header=>`"${header.replace(/"/g,'""')}"`).join(',')+'\n';
data.forEach(row=>{
const values=headers.map(header=>{
const value=row[header]||'';
return `"${String(value).replace(/"/g,'""')}"`;
});
csvContent+=values.join(',')+'\n'
});
const blob=new Blob(['\uFEFF'+csvContent],{type:'text/csv;charset=utf-8'});
const link=document.createElement('a');
const url=URL.createObjectURL(blob);
link.href=url;
link.download=filename;
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
URL.revokeObjectURL(url)
}catch(error){
console.error('CSV ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:',error);
alert('íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
}
},
getSortIcon(tab,col){const sort=kt_state.sorts[`${tab}-${col}`];return !sort?'â†•':sort==='asc'?'â†‘':'â†“'},
getBadge(value){const isActive=value==='Y';return `<span class="sb2 ${isActive?'sa':'si'}">${isActive?'í™œë™ì¤‘':'ë¹„í™œë™'}</span>`}
};

// í˜ì´ì§€ ì „í™˜
function switchPage(page){
document.querySelectorAll('.gnb-btn').forEach(btn=>btn.classList.remove('active'));
document.querySelector(`[data-page="${page}"]`).classList.add('active');
document.getElementById('kakaoPage').classList.toggle('hidden',page!=='kakao');
document.getElementById('groupPage').classList.toggle('hidden',page!=='group')
}

// ì¹´ì¹´ì˜¤í†¡ ë¶„ì„ í•¨ìˆ˜ë“¤
function kt_parseFile(content,filename){
if(filename.toLowerCase().endsWith('.eml')){const lines=content.split('\n');let inBody=false;const bodyLines=[];for(const line of lines){if(inBody)bodyLines.push(line);else if(line.trim()==='')inBody=true}if(bodyLines.length>0)content=bodyLines.join('\n')}
const patterns={msg:/^(\d{4}ë…„ \d{1,2}ì›” \d{1,2}ì¼ (ì˜¤ì „|ì˜¤í›„) \d{1,2}:\d{2}), ([^:\n]+?) ?: (.+)/,enter:/^(\d{4}ë…„ \d{1,2}ì›” \d{1,2}ì¼ (ì˜¤ì „|ì˜¤í›„) \d{1,2}:\d{2}), (.+?)ë‹˜ì´ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤[.]/,leave:/^(\d{4}ë…„ \d{1,2}ì›” \d{1,2}ì¼ (ì˜¤ì „|ì˜¤í›„) \d{1,2}:\d{2}), (.+?)ë‹˜ì´ ë‚˜ê°”ìŠµë‹ˆë‹¤[.]/,kick:/^(\d{4}ë…„ \d{1,2}ì›” \d{1,2}ì¼ (ì˜¤ì „|ì˜¤í›„) \d{1,2}:\d{2}), (.+?)ë‹˜ì„ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤[.]/,hidden:/^(\d{4}ë…„ \d{1,2}ì›” \d{1,2}ì¼ (ì˜¤ì „|ì˜¤í›„) \d{1,2}:\d{2}), ì±„íŒ…ë°© ê´€ë¦¬ìê°€ ë©”ì‹œì§€ë¥¼ ê°€ë ¸ìŠµë‹ˆë‹¤/};
const messages=[],enters=[],leaves=[],kicks=[],lines=content.split('\n');let msgIndex=0;
for(const line of lines){const trimmed=line.trim();if(!trimmed)continue;try{const msgMatch=trimmed.match(patterns.msg),enterMatch=trimmed.match(patterns.enter),leaveMatch=trimmed.match(patterns.leave),kickMatch=trimmed.match(patterns.kick),hiddenMatch=trimmed.match(patterns.hidden);
if(msgMatch){const[,timeStr,,nickname,message]=msgMatch;const datetime=kt_utils.parseTime(timeStr);if(datetime)messages.push({datetime,nickname:nickname.trim(),message:message.trim(),originalIndex:msgIndex++})}
else if(enterMatch){const[,timeStr,,nickname]=enterMatch;const datetime=kt_utils.parseTime(timeStr);if(datetime){enters.push({datetime,nickname:nickname.trim()});messages.push({datetime,nickname:nickname.trim(),message:trimmed,originalIndex:msgIndex++})}}
else if(leaveMatch){const[,timeStr,,nickname]=leaveMatch;const datetime=kt_utils.parseTime(timeStr);if(datetime){leaves.push({datetime,nickname:nickname.trim()});messages.push({datetime,nickname:nickname.trim(),message:trimmed,originalIndex:msgIndex++})}}
else if(kickMatch){const[,timeStr,,nickname]=kickMatch;const datetime=kt_utils.parseTime(timeStr);if(datetime){kicks.push({datetime,nickname:nickname.trim()});messages.push({datetime,nickname:nickname.trim(),message:trimmed,originalIndex:msgIndex++})}}
else if(hiddenMatch){const[,timeStr]=hiddenMatch;const datetime=kt_utils.parseTime(timeStr);if(datetime)messages.push({datetime,nickname:'ì±„íŒ…ë°© ê´€ë¦¬ì',message:'ì±„íŒ…ë°© ê´€ë¦¬ìê°€ ë©”ì‹œì§€ë¥¼ ê°€ë ¸ìŠµë‹ˆë‹¤',originalIndex:msgIndex++})}}catch(e){continue}}
const nicknames=[...new Set([...messages.map(m=>m.nickname),...enters.map(e=>e.nickname),...leaves.map(l=>l.nickname),...kicks.map(k=>k.nickname)])].sort();
const twoMonthsAgo=new Date();twoMonthsAgo.setMonth(twoMonthsAgo.getMonth()-2);
const priorTag="íŒŒì¼ ì²¨ë¶€ìë³´ë‹¤ ë¨¼ì € ë“¤ì–´ì˜¨ ë©¤ë²„";
const summary=nicknames.map(nick=>{
const userMsgs=messages.filter(m=>m.nickname===nick);
const userMsgsExcl=userMsgs.filter(m=>!m.message.includes('ë‹˜ì´ ë‚˜ê°”ìŠµë‹ˆë‹¤')&&!m.message.includes('ë‹˜ì„ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤'));
const userEnters=enters.filter(e=>e.nickname===nick);
const userLeaves=leaves.filter(l=>l.nickname===nick);
const userKicks=kicks.filter(k=>k.nickname===nick);
const firstMsg=userMsgsExcl.length>0?userMsgsExcl[0].datetime:'';
const lastMsg=userMsgsExcl.length>0?userMsgsExcl[userMsgsExcl.length-1].datetime:'';
let firstEntry='',firstEntryDate='',entryCount='',leaveCount='',kickCount='',leaveDates=[],kickDates=[],enterDates=[];
if(userEnters.length>0){
firstEntry=userEnters[0].datetime;firstEntryDate=userEnters[0].datetime.split(' ')[0];entryCount=userEnters.length;leaveCount=userLeaves.length;kickCount=userKicks.length;
leaveDates=userLeaves.map(l=>l.datetime.split(' ')[0]);kickDates=userKicks.map(k=>k.datetime.split(' ')[0]);enterDates=userEnters.map(e=>e.datetime.split(' ')[0])
}else{firstEntry=firstEntryDate=entryCount=leaveCount=kickCount=priorTag;leaveDates=kickDates=enterDates=[priorTag]}
const lastLeave=userLeaves.length>0?new Date(userLeaves[userLeaves.length-1].datetime):null;
const lastEnter=userEnters.length>0?new Date(userEnters[userEnters.length-1].datetime):null;
const lastMsgDate=lastMsg?new Date(lastMsg):null;
const conditions=[
lastLeave&&lastEnter&&lastLeave>lastEnter,
userMsgsExcl.length===0&&userEnters.length===0,
lastMsgDate&&lastMsgDate<twoMonthsAgo,
userMsgs.length>0&&(userMsgs[userMsgs.length-1].message.includes('ë‹˜ì´ ë‚˜ê°”ìŠµë‹ˆë‹¤')||userMsgs[userMsgs.length-1].message.includes('ë‹˜ì„ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤'))
];
const status=conditions.some(Boolean)?'N':'Y';
let inactiveReason='',inactiveDate='';
if(status==='N'){
if(conditions[3]){inactiveReason='ë§ˆì§€ë§‰ ë©”ì‹œì§€ê°€ í‡´ì¥/ê°•í‡´';inactiveDate=userMsgs.length>0?userMsgs[userMsgs.length-1].datetime.split(' ')[0]:''}
else if(conditions[0]){inactiveReason='ë§ˆì§€ë§‰ í™œë™ì´ í‡´ì¥';inactiveDate=lastLeave?lastLeave.toISOString().split('T')[0]:''}
else if(conditions[2]){inactiveReason='2ê°œì›” ì´ìƒ ë¯¸í™œë™(ì±„íŒ… ê¸°ì¤€)';const inactiveFrom=new Date(lastMsgDate);inactiveFrom.setMonth(inactiveFrom.getMonth()+2);inactiveDate=inactiveFrom.toISOString().split('T')[0]}
else if(conditions[1]){inactiveReason='ë©”ì‹œì§€ ë° ì…ì¥ ê¸°ë¡ ì—†ìŒ';inactiveDate=priorTag}
}
return {'ë‹‰ë„¤ì„':nick,'í˜„ì¬ ìƒíƒœ(ì¶”ì •ê°’)':status,'ë¹„í™œë™ ì²˜ë¦¬ ê·¼ê±°':inactiveReason,'ë¹„í™œë™ ì²˜ë¦¬ ì¼ì':inactiveDate,'ë©”ì‹œì§€ ìˆ˜':userMsgsExcl.length,'ì…ì¥ íšŸìˆ˜':entryCount,'í‡´ì¥ íšŸìˆ˜':leaveCount,'ê°•í‡´ íšŸìˆ˜':kickCount,'ì²« ì…ì¥ ì‹œê°':firstEntry,'ì²« ë©”ì‹œì§€ ì‹œê°':firstMsg,'ë§ˆì§€ë§‰ ë©”ì‹œì§€ ì‹œê°':lastMsg,'ì²« ì…ì¥ ë‚ ì§œ':firstEntryDate,'ì²« ë©”ì‹œì§€ ë‚ ì§œ':firstMsg?firstMsg.split(' ')[0]:'','ë§ˆì§€ë§‰ ë©”ì‹œì§€ ë‚ ì§œ':lastMsg?lastMsg.split(' ')[0]:'','í‡´ì¥ ì¼ì ë¦¬ìŠ¤íŠ¸':JSON.stringify(leaveDates),'ê°•í‡´ ì¼ì ë¦¬ìŠ¤íŠ¸':JSON.stringify(kickDates),'ì…ì¥ ì¼ì ë¦¬ìŠ¤íŠ¸':JSON.stringify(enterDates)}
});
const active=summary.filter(s=>s['í˜„ì¬ ìƒíƒœ(ì¶”ì •ê°’)']==='Y');
const inactive=summary.filter(s=>{
if(s['í˜„ì¬ ìƒíƒœ(ì¶”ì •ê°’)']==='N'&&s['ë¹„í™œë™ ì²˜ë¦¬ ê·¼ê±°']==='2ê°œì›” ì´ìƒ ë¯¸í™œë™(ì±„íŒ… ê¸°ì¤€)'){
const processDate=s['ë¹„í™œë™ ì²˜ë¦¬ ì¼ì'];
if(!processDate||processDate==='íŒŒì¼ ì²¨ë¶€ìë³´ë‹¤ ë¨¼ì € ë“¤ì–´ì˜¨ ë©¤ë²„')return false;
const pDate=new Date(processDate);
const twoMonthsAgoCheck=new Date();
twoMonthsAgoCheck.setMonth(twoMonthsAgoCheck.getMonth()-2);
return pDate>=twoMonthsAgoCheck&&pDate<=new Date()
}
return false
}).sort((a,b)=>new Date(b['ë¹„í™œë™ ì²˜ë¦¬ ì¼ì'])-new Date(a['ë¹„í™œë™ ì²˜ë¦¬ ì¼ì']));
const messagesWithDate=messages.map(msg=>({date:msg.datetime?msg.datetime.split(' ')[0]:'',datetime:msg.datetime,nickname:msg.nickname,message:msg.message,originalIndex:msg.originalIndex}));
return {messages:messagesWithDate,summary,active,inactive}
}

function kt_updateTable(){
const data=kt_state.filtered[kt_state.currentTab];
const header=document.getElementById('kt_tableHeader');
const body=document.getElementById('kt_tableBody');
if(!header||!body)return;
const transposeBtn=document.getElementById('kt_transposeBtn');
if(['summary','active','inactive'].includes(kt_state.currentTab)){transposeBtn.classList.remove('hidden');transposeBtn.classList.toggle('active',kt_state.transpose[kt_state.currentTab])}else{transposeBtn.classList.add('hidden')}
if(kt_state.data.messages.length>0)document.getElementById('kt_guideSection').style.display='none';else document.getElementById('kt_guideSection').style.display='block';
if(kt_state.currentTab==='messages'){
const cols=['date','datetime','nickname','message'];
header.innerHTML=cols.map(col=>`<th style="position:relative"><div class="ch"><div class="ct">${col}</div><div class="cc"><button class="cb2 ${kt_state.filters[`messages-${col}`]?'active':''}" onclick="kt_toggleFilter('messages','${col}')" title="í•„í„°">ğŸ”</button><button class="cb2 sb ${kt_state.sorts[`messages-${col}`]?'active':''}" onclick="kt_toggleSort('messages','${col}')" title="ì •ë ¬">${kt_utils.getSortIcon('messages',col)}</button></div></div><div class="fd" id="kt_filter-messages-${col}"></div></th>`).join('');
if(!data||data.length===0){body.innerHTML=Object.keys(kt_state.filters).some(k=>k.startsWith('messages-'))?'<tr><td class="empty-state" colspan="4">í•„í„° ì¡°ê±´ì— ë§ëŠ” ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>':'<tr><td class="empty-state" colspan="4">ì „ì²´ ë©”ì‹œì§€ ë°ì´í„°ëŠ” ìš©ëŸ‰ì´ í½ë‹ˆë‹¤.<br>í•„í„°ë¥¼ ì ìš©í•˜ì—¬ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.</td></tr>';return}
body.innerHTML=data.map(row=>`<tr><td title="${row.date}">${row.date}</td><td title="${row.datetime}">${row.datetime}</td><td title="${row.nickname}">${row.nickname}</td><td title="${row.message}">${row.message}</td></tr>`).join('')
}else{
if(kt_state.transpose[kt_state.currentTab]&&data&&data.length>0){
const cols=Object.keys(data[0]);
let filteredCols=cols;
if(kt_state.currentTab==='active')filteredCols=cols.filter(c=>!c.includes('ë¹„í™œë™'));
header.innerHTML=`<th>í•„ë“œëª…</th>${data.map((row,i)=>`<th>${row['ë‹‰ë„¤ì„']||`í•­ëª©${i+1}`}</th>`).join('')}`;
body.innerHTML=filteredCols.map(col=>`<tr><td style="background:#f1f3f4;font-weight:600">${col}</td>${data.map(row=>{let val=row[col]||'';return col==='í˜„ì¬ ìƒíƒœ(ì¶”ì •ê°’)'?`<td>${kt_utils.getBadge(val)}</td>`:`<td style="text-align:left" title="${val}">${val}</td>`}).join('')}</tr>`).join('')
}else{
let cols=kt_state.data[kt_state.currentTab]?.length>0?Object.keys(kt_state.data[kt_state.currentTab][0]):[];
if(kt_state.currentTab==='active')cols=cols.filter(c=>!c.includes('ë¹„í™œë™'));
if(kt_state.currentTab==='inactive')cols=cols.filter(c=>c!=='í˜„ì¬ ìƒíƒœ(ì¶”ì •ê°’)');
if(cols.length>0)header.innerHTML=cols.map(col=>`<th style="position:relative"><div class="ch"><div class="ct">${col}</div><div class="cc"><button class="cb2 ${kt_state.filters[`${kt_state.currentTab}-${col}`]?'active':''}" onclick="kt_toggleFilter('${kt_state.currentTab}','${col}')" title="í•„í„°">ğŸ”</button><button class="cb2 sb ${kt_state.sorts[`${kt_state.currentTab}-${col}`]?'active':''}" onclick="kt_toggleSort('${kt_state.currentTab}','${col}')" title="ì •ë ¬">${kt_utils.getSortIcon(kt_state.currentTab,col)}</button></div></div><div class="fd" id="kt_filter-${kt_state.currentTab}-${col}"></div></th>`).join('');
if(!data||data.length===0){body.innerHTML=Object.keys(kt_state.filters).some(k=>k.startsWith(`${kt_state.currentTab}-`))?'<tr><td class="empty-state">í•„í„° ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>':'<tr><td class="empty-state">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';return}
body.innerHTML=data.map(row=>`<tr>${cols.map(col=>{
let val=row[col]||'';
if(col==='í˜„ì¬ ìƒíƒœ(ì¶”ì •ê°’)')return `<td>${kt_utils.getBadge(val)}</td>`;
if(col.includes('ë¦¬ìŠ¤íŠ¸')){try{const arr=JSON.parse(val);val=Array.isArray(arr)?arr.join(', '):val}catch(e){}}
const isNum=!isNaN(val)&&val!==''&&!col.includes('ì‹œê°')&&!col.includes('ë‚ ì§œ')&&!col.includes('ë¦¬ìŠ¤íŠ¸')&&!col.includes('ë‹‰ë„¤ì„');
return `<td style="text-align:${isNum?'right':'left'}" title="${row[col]||''}">${val}</td>`
}).join('')}</tr>`).join('')
}
}
kt_updateScrollbar()
}

function kt_updateScrollbar(){
const wrapper=document.getElementById('kt_tableWrapper');
const scrollbar=document.getElementById('kt_horizontalScrollbar');
const content=document.getElementById('kt_horizontalScrollbarContent');
if(!wrapper||!scrollbar||!content)return;
const table=wrapper.querySelector('.table');
if(table){
const tableWidth=table.scrollWidth;
const containerWidth=wrapper.clientWidth;
if(tableWidth>containerWidth){
scrollbar.style.display='block';
content.style.width=tableWidth+'px'
}else{
scrollbar.style.display='none'
}
}else{
scrollbar.style.display='none'
}
}

function kt_toggleFilter(tab,col){
const id=`kt_filter-${tab}-${col}`,dropdown=document.getElementById(id);
if(!dropdown)return;
document.querySelectorAll('.fd').forEach(d=>{if(d.id!==id)d.style.display='none'});
if(dropdown.style.display==='block'){dropdown.style.display='none';return}
if(col==='date'){
const filter=kt_state.filters[`${tab}-${col}`],from=filter?.from||'',to=filter?.to||'';
dropdown.innerHTML=`<div style="padding:10px;background:var(--l)"><label style="font-size:11px;color:#666;display:block;margin-bottom:3px">ì‹œì‘:</label><input type="date" class="fs" id="kt_dateFrom-${tab}-${col}" value="${from}" onchange="kt_applyDateFilter('${tab}','${col}')" style="margin-bottom:5px"><label style="font-size:11px;color:#666;display:block;margin-bottom:3px">ì¢…ë£Œ:</label><input type="date" class="fs" id="kt_dateTo-${tab}-${col}" value="${to}" onchange="kt_applyDateFilter('${tab}','${col}')"><button class="btn btn-secondary" onclick="kt_clearDateFilter('${tab}','${col}')" style="width:100%;font-size:11px;padding:4px;margin-top:8px">ì´ˆê¸°í™”</button></div>`
}else{
const sourceData=tab==='messages'?kt_state.data.messages:kt_state.data[tab],unique=[...new Set(sourceData.map(r=>r[col]))].sort();
dropdown.innerHTML=`<div class="fh"><input type="text" class="fs" placeholder="ê²€ìƒ‰..." onkeyup="kt_filterOptions('${tab}','${col}',this.value)"></div><div style="display:flex;gap:5px;padding:8px;background:var(--l)"><button class="btn btn-primary" onclick="kt_selectAllOptions('${tab}','${col}',1)" style="font-size:11px;padding:4px">ì „ì²´</button><button class="btn btn-secondary" onclick="kt_selectAllOptions('${tab}','${col}',0)" style="font-size:11px;padding:4px">í•´ì œ</button></div><div style="max-height:200px;overflow-y:auto">${unique.map(val=>`<div class="fi filter-option"><label><input type="checkbox" value="${val}" ${!kt_state.filters[`${tab}-${col}`]||(Array.isArray(kt_state.filters[`${tab}-${col}`])&&kt_state.filters[`${tab}-${col}`].includes(String(val)))?'checked':''} onchange="kt_applyFilter('${tab}','${col}')"><span>${val||'(ë¹ˆê°’)'}</span></label></div>`).join('')}</div>`
}
dropdown.style.display='block'
}

function kt_applyDateFilter(tab,col){
const from=document.getElementById(`kt_dateFrom-${tab}-${col}`).value,to=document.getElementById(`kt_dateTo-${tab}-${col}`).value;
from||to?kt_state.filters[`${tab}-${col}`]={type:'date',from,to}:delete kt_state.filters[`${tab}-${col}`];
kt_applyAllFilters()
}

function kt_clearDateFilter(tab,col){
delete kt_state.filters[`${tab}-${col}`];
document.getElementById(`kt_dateFrom-${tab}-${col}`).value='';
document.getElementById(`kt_dateTo-${tab}-${col}`).value='';
kt_applyAllFilters()
}

function kt_filterOptions(tab,col,term){
document.getElementById(`kt_filter-${tab}-${col}`).querySelectorAll('.filter-option').forEach(opt=>opt.style.display=opt.textContent.toLowerCase().includes(term.toLowerCase())?'block':'none')
}

function kt_selectAllOptions(tab,col,select){
document.getElementById(`kt_filter-${tab}-${col}`).querySelectorAll('.filter-option input').forEach(cb=>{if(cb.parentElement.parentElement.style.display!=='none')cb.checked=select});
kt_applyFilter(tab,col)
}

function kt_applyFilter(tab,col){
const all=document.getElementById(`kt_filter-${tab}-${col}`).querySelectorAll('.filter-option input'),checked=Array.from(all).filter(cb=>cb.checked).map(cb=>cb.value);
checked.length===0?kt_state.filters[`${tab}-${col}`]=[]:checked.length===all.length?delete kt_state.filters[`${tab}-${col}`]:kt_state.filters[`${tab}-${col}`]=checked;
kt_applyAllFilters()
}

function kt_applyAllFilters(){
['summary','active','inactive'].forEach(tab=>{
let data=[...kt_state.data[tab]];
Object.keys(kt_state.filters).forEach(key=>{
if(key.startsWith(`${tab}-`)){
const col=key.replace(`${tab}-`,''),filter=kt_state.filters[key];
if(filter?.type==='date'){data=data.filter(row=>{const d=row[col];return d&&(!filter.from||d>=filter.from)&&(!filter.to||d<=filter.to)})}
else if(Array.isArray(filter)){data=filter.length?data.filter(row=>filter.includes(String(row[col]))):[]}
}
});
kt_state.filtered[tab]=data
});
let msgData=[...kt_state.data.messages];
Object.keys(kt_state.filters).filter(k=>k.startsWith('messages-')).forEach(key=>{
const col=key.replace('messages-',''),filter=kt_state.filters[key];
if(filter?.type==='date'){msgData=msgData.filter(row=>{const d=row[col];return d&&(!filter.from||d>=filter.from)&&(!filter.to||d<=filter.to)})}
else if(Array.isArray(filter)){msgData=filter.length?msgData.filter(row=>filter.includes(String(row[col]))):[]}
});
kt_state.filtered.messages=Object.keys(kt_state.filters).some(k=>k.startsWith('messages-'))?msgData:[];
kt_updateCounts();
kt_updateTable()
}

function kt_toggleSort(tab,col){
const key=`${tab}-${col}`;
Object.keys(kt_state.sorts).forEach(k=>{if(k.startsWith(`${tab}-`)&&k!==key)delete kt_state.sorts[k]});
kt_state.sorts[key]=!kt_state.sorts[key]||kt_state.sorts[key]==='desc'?'asc':'desc';
const data=kt_state.filtered[tab],isAsc=kt_state.sorts[key]==='asc';
data.sort((a,b)=>{
let aVal=a[col]||'',bVal=b[col]||'';
if(!isNaN(aVal)&&!isNaN(bVal)&&aVal&&bVal)return isAsc?aVal-bVal:bVal-aVal;
if(col.includes('ì‹œê°')||col.includes('ë‚ ì§œ')||col==='datetime'||col==='date'){const aDate=new Date(aVal),bDate=new Date(bVal);if(!isNaN(aDate)&&!isNaN(bDate))return isAsc?aDate-bDate:bDate-aDate}
const result=isAsc?aVal.toString().localeCompare(bVal.toString()):bVal.toString().localeCompare(aVal.toString());
return result||(tab==='messages'&&a.originalIndex!==undefined&&b.originalIndex!==undefined?(isAsc?a.originalIndex-b.originalIndex:b.originalIndex-a.originalIndex):0)
});
kt_updateTable()
}

function kt_switchTab(tab){
kt_state.currentTab=tab;
document.querySelectorAll('.tab-btn').forEach(btn=>btn.classList.remove('active'));
document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
kt_updateTable()
}

function kt_transpose(){
if(['summary','active','inactive'].includes(kt_state.currentTab)){
kt_state.transpose[kt_state.currentTab]=!kt_state.transpose[kt_state.currentTab];
kt_updateTable()
}
}

function kt_updateCounts(){
document.getElementById('kt_messageCount').textContent=kt_state.data.messages.length;
document.getElementById('kt_activeUserCount').textContent=kt_state.data.active.length;
document.getElementById('kt_totalUserCount').textContent=kt_state.data.summary.length;
document.getElementById('kt_activeCount').textContent=kt_state.filtered.active.length;
document.getElementById('kt_summaryCount').textContent=kt_state.filtered.summary.length;
document.getElementById('kt_inactiveCount').textContent=kt_state.filtered.inactive.length;
document.getElementById('kt_filteredMessageCount').textContent=kt_state.filtered.messages.length
}

async function kt_handleFile(file){
document.getElementById('kt_fileName').textContent=`ì—…ë¡œë“œë¨: ${file.name} (${(file.size/1024/1024).toFixed(2)}MB)`;
document.getElementById('kt_fileName').classList.remove('hidden');
try{
const content=await new Promise((resolve,reject)=>{
const reader=new FileReader();
reader.onload=e=>resolve(e.target.result);
reader.onerror=()=>reject(new Error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨'));
reader.readAsText(file,'utf-8')
});
const results=kt_parseFile(content,file.name);
kt_state.data=results;
kt_state.filtered={messages:[],summary:results.summary,active:results.active,inactive:results.inactive};
kt_updateCounts();
kt_updateTable();
document.getElementById('kt_messageStats').classList.remove('hidden');
document.getElementById('kt_tabControlBar').classList.remove('hidden');
document.getElementById('kt_guideSection').style.display='none';
document.getElementById('kt_tableWrapper').classList.remove('hidden')
}catch(error){
console.error('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:',error);
alert('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: '+error.message)
}
}

// ê·¸ë£¹ ë°°ì¹˜ í•¨ìˆ˜ë“¤
function gp_adjust(type,delta){
const input=document.getElementById(`gp_${type}Count`);
let value=parseInt(input.value);
if(type==='participants'){value=Math.max(2,Math.min(50,value+delta))}
else if(type==='groups'){const max=Math.floor(parseInt(document.getElementById('gp_participantsCount').value)/1);value=Math.max(1,Math.min(max,value+delta))}
else if(type==='rounds'){value=Math.max(1,Math.min(20,value+delta))}
input.value=value;
if(type==='participants'){gp_updateParticipantsGrid()}
else if(type==='groups'){gp_updateGroupNamesGrid()}
}

function gp_setTime(minutes){
gp_timeInterval=minutes;
document.querySelectorAll('.time-btn').forEach(btn=>btn.classList.remove('active'));
document.querySelector(`[data-minutes="${minutes}"]`).classList.add('active');
document.getElementById('gp_intervalDisplay').textContent=`ì„ íƒëœ ê°„ê²©: ${minutes}ë¶„`
}

function gp_formatTime(time24){
const[hour,minute]=time24.split(':').map(Number);
const period=hour<12?'ì˜¤ì „':'ì˜¤í›„';
const displayHour=hour===0?12:hour>12?hour-12:hour;
return `${period} ${displayHour}:${minute.toString().padStart(2,'0')}`
}

function gp_calculateTimeSchedule(startTime,roundCount,intervalMinutes){
const schedules=[];
const[startHour,startMinute]=startTime.split(':').map(Number);
for(let i=0;i<roundCount;i++){
const roundStartMinutes=startHour*60+startMinute+(i*intervalMinutes);
const roundEndMinutes=roundStartMinutes+intervalMinutes;
const startH=Math.floor(roundStartMinutes/60)%24;
const startM=roundStartMinutes%60;
const endH=Math.floor(roundEndMinutes/60)%24;
const endM=roundEndMinutes%60;
const start24=`${startH.toString().padStart(2,'0')}:${startM.toString().padStart(2,'0')}`;
const end24=`${endH.toString().padStart(2,'0')}:${endM.toString().padStart(2,'0')}`;
schedules.push({start:gp_formatTime(start24),end:gp_formatTime(end24)})
}
return schedules
}

function gp_updateParticipantsGrid(){
const count=parseInt(document.getElementById('gp_participantsCount').value);
const grid=document.getElementById('gp_participantsGrid');
const existingInputs=Array.from(grid.querySelectorAll('input'));
const existingData=existingInputs.map(input=>input.value);
grid.innerHTML='';
for(let i=0;i<count;i++){
const input=document.createElement('input');
input.type='text';input.className='input';input.placeholder=`ì°¸ì„ì ${i+1}`;
input.value=existingData[i]||`ì°¸ì„ì${i+1}`;
input.addEventListener('input',gp_updateParticipantsList);
grid.appendChild(input)
}
gp_updateParticipantsList()
}

function gp_updateGroupNamesGrid(){
const count=parseInt(document.getElementById('gp_groupsCount').value);
const grid=document.getElementById('gp_groupNamesGrid');
const existingInputs=Array.from(grid.querySelectorAll('input'));
const existingData=existingInputs.map(input=>input.value);
grid.innerHTML='';
for(let i=0;i<count;i++){
const input=document.createElement('input');
input.type='text';input.className='input';input.placeholder=`ê·¸ë£¹ ${i+1}`;
input.value=existingData[i]||`ê·¸ë£¹ ${i+1}`;
input.addEventListener('input',gp_updateGroupNamesList);
grid.appendChild(input)
}
gp_updateGroupNamesList()
}

function gp_updateParticipantsList(){
const inputs=document.querySelectorAll('#gp_participantsGrid input');
gp_participants=Array.from(inputs).map(input=>input.value.trim()||input.placeholder);
gp_updateConstraintSelectors()
}

function gp_updateGroupNamesList(){
const inputs=document.querySelectorAll('#gp_groupNamesGrid input');
gp_groupNames=Array.from(inputs).map(input=>input.value.trim()||input.placeholder)
}

function gp_updateConstraintSelectors(){
gp_updateParticipantChips('gp_separationParticipants');
gp_updateParticipantChips('gp_setParticipants')
}

function gp_updateParticipantChips(containerId){
const container=document.getElementById(containerId);
container.innerHTML='';
gp_participants.forEach((participant,index)=>{
const chip=document.createElement('div');
chip.className='chip';chip.textContent=participant;chip.dataset.index=index;
chip.addEventListener('click',function(){chip.classList.toggle('selected')});
container.appendChild(chip)
})
}

function gp_showConstraintSelector(type){
const selector=document.getElementById(`gp_${type}Selector`);
selector.classList.remove('hidden');
gp_updateParticipantChips(`gp_${type}Participants`)
}

function gp_hideConstraintSelector(type){
const selector=document.getElementById(`gp_${type}Selector`);
selector.classList.add('hidden');
const chips=selector.querySelectorAll('.chip');
chips.forEach(chip=>chip.classList.remove('selected'))
}

function gp_confirmConstraint(type){
const container=document.getElementById(`gp_${type}Participants`);
const selectedChips=container.querySelectorAll('.chip.selected');
if(selectedChips.length<2){gp_showAlert('warning','ìµœì†Œ 2ëª… ì´ìƒì˜ ì°¸ì„ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');return}
const selectedIndices=Array.from(selectedChips).map(chip=>parseInt(chip.dataset.index));
const selectedNames=selectedIndices.map(index=>gp_participants[index]);
if(type==='separation'){gp_separationConstraints.push(selectedIndices)}else{gp_setConstraints.push(selectedIndices)}
gp_displayConstraint(type,selectedNames,selectedIndices);
gp_hideConstraintSelector(type)
}

function gp_displayConstraint(type,names,indices){
const container=document.getElementById(`gp_${type}Constraints`);
const item=document.createElement('div');
item.className='constraint-item';
const color=type==='separation'?'danger':'primary';
item.innerHTML=`<div>${names.join(', ')}</div><button class="btn btn-${color} btn-sm" onclick="gp_removeConstraint(this,'${type}',${JSON.stringify(indices)})">ì‚­ì œ</button>`;
container.appendChild(item)
}

function gp_removeConstraint(button,type,indices){
button.parentElement.remove();
if(type==='separation'){gp_separationConstraints=gp_separationConstraints.filter(constraint=>JSON.stringify(constraint)!==JSON.stringify(indices))}
else{gp_setConstraints=gp_setConstraints.filter(constraint=>JSON.stringify(constraint)!==JSON.stringify(indices))}
}

function gp_showAlert(type,message){
const container=document.getElementById('gp_alertContainer');
const alert=document.createElement('div');
alert.className=`alert alert-${type}`;
const icon=type==='success'?'âœ…':type==='warning'?'âš ï¸':'âŒ';
alert.innerHTML=`${icon} ${message}`;
container.innerHTML='';
container.appendChild(alert);
setTimeout(()=>{if(alert.parentElement){alert.remove()}},5000)
}

function gp_validate(){
const participantCount=gp_participants.length;
const groupCount=parseInt(document.getElementById('gp_groupsCount').value);
const uniqueNames=new Set(gp_participants.map(name=>name.trim()));
if(uniqueNames.size!==gp_participants.length){gp_showAlert('warning','ì°¸ì„ì ì´ë¦„ì´ ì¤‘ë³µë©ë‹ˆë‹¤.');return false}
if(gp_participants.some(name=>!name.trim())){gp_showAlert('warning','ëª¨ë“  ì°¸ì„ìì˜ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');return false}
if(groupCount>participantCount){gp_showAlert('warning','ê·¸ë£¹ ìˆ˜ëŠ” ì°¸ì„ì ìˆ˜ë³´ë‹¤ í´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');return false}
return true
}

function gp_createMeetingMatrix(participantCount){
const matrix=[];
for(let i=0;i<participantCount;i++){matrix[i]=new Array(participantCount).fill(0)}
return matrix
}

function gp_calculateGroupSizes(participantCount,groupCount){
const baseSize=Math.floor(participantCount/groupCount);
const remainder=participantCount%groupCount;
const sizes=[];
for(let i=0;i<groupCount;i++){sizes.push(baseSize+(i<remainder?1:0))}
return sizes
}

function gp_generateRandomArrangement(participantCount,groupCount){
const shuffled=Array.from({length:participantCount},(_, i)=>i);
for(let i=shuffled.length-1;i>0;i--){
const j=Math.floor(Math.random()*(i+1));
[shuffled[i],shuffled[j]]=[shuffled[j],shuffled[i]]
}
const groupSizes=gp_calculateGroupSizes(participantCount,groupCount);
const arrangement=[];
let index=0;
for(const size of groupSizes){arrangement.push(shuffled.slice(index,index+size));index+=size}
return arrangement
}

function gp_isValidArrangement(arrangement,round,previousResults){
for(const constraint of gp_separationConstraints){
for(const group of arrangement){
const intersection=constraint.filter(p=>group.includes(p));
if(intersection.length>1){return false}
}
}
for(const constraint of gp_setConstraints){
let satisfied=false;
const allResults=[...previousResults,arrangement];
for(const result of allResults){
for(const group of result){
const intersection=constraint.filter(p=>group.includes(p));
if(intersection.length>=constraint.length){satisfied=true;break}
}
if(satisfied)break
}
if(!satisfied&&round===parseInt(document.getElementById('gp_roundsCount').value)-1){return false}
}
return true
}

function gp_calculateScore(arrangement,meetingMatrix){
let score=0;
for(const group of arrangement){
for(let i=0;i<group.length;i++){
for(let j=i+1;j<group.length;j++){
const p1=group[i];const p2=group[j];
const meetingCount=meetingMatrix[p1][p2];
score+=Math.max(0,10-meetingCount*5)
}
}
}
return score
}

function gp_updateMeetingMatrix(meetingMatrix,arrangement){
for(const group of arrangement){
for(let i=0;i<group.length;i++){
for(let j=i+1;j<group.length;j++){
const p1=group[i];const p2=group[j];
meetingMatrix[p1][p2]++;meetingMatrix[p2][p1]++
}
}
}
}

function gp_findBestArrangement(participantCount,groupCount,meetingMatrix,round,previousResults){
let best=null;let bestScore=-Infinity;const maxAttempts=3000;
for(let attempt=0;attempt<maxAttempts;attempt++){
const arrangement=gp_generateRandomArrangement(participantCount,groupCount);
if(!gp_isValidArrangement(arrangement,round,previousResults)){continue}
const score=gp_calculateScore(arrangement,meetingMatrix);
if(score>bestScore){bestScore=score;best=arrangement.map(group=>[...group])}
}
return best
}

function gp_optimize(participantCount,groupCount,roundCount){
const results=[];const meetingMatrix=gp_createMeetingMatrix(participantCount);
for(let round=0;round<roundCount;round++){
const arrangement=gp_findBestArrangement(participantCount,groupCount,meetingMatrix,round,results);
if(!arrangement){throw new Error(`${round+1}íšŒì°¨ ë°°ì¹˜ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`)}
results.push(arrangement);gp_updateMeetingMatrix(meetingMatrix,arrangement)
}
return results
}

function gp_generate(){
const participantCount=gp_participants.length;
const groupCount=parseInt(document.getElementById('gp_groupsCount').value);
const roundCount=parseInt(document.getElementById('gp_roundsCount').value);
if(!gp_validate()){return}
try{
gp_results=gp_optimize(participantCount,groupCount,roundCount);
gp_displayResults();
gp_showAlert('success',`${roundCount}íšŒì˜ ê·¸ë£¹ ë°°ì¹˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`);
document.getElementById('gp_resultsSection').classList.remove('hidden');
document.getElementById('gp_resultsSection').scrollIntoView({behavior:'smooth'})
}catch(error){
console.error('ë°°ì¹˜ ì˜¤ë¥˜:',error);
gp_showAlert('danger',`ê·¸ë£¹ ë°°ì¹˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`)
}
}

function gp_displayResults(){
const container=document.getElementById('gp_resultsContainer');
container.innerHTML='';
const roundCount=parseInt(document.getElementById('gp_roundsCount').value);
const timeSchedules=gp_calculateTimeSchedule(gp_startTime,roundCount,gp_timeInterval);
gp_results.forEach((arrangement,roundIndex)=>{
const roundDiv=document.createElement('div');
roundDiv.className='round';
const title=document.createElement('div');
title.className='round-title';
title.textContent=`ğŸ”„ ${roundIndex+1}íšŒì°¨ ë°°ì¹˜`;
if(timeSchedules[roundIndex]){
const timeInfo=document.createElement('div');
timeInfo.style.fontSize='14px';timeInfo.style.color='var(--m)';timeInfo.style.textAlign='center';
timeInfo.textContent=`â° ${timeSchedules[roundIndex].start} ~ ${timeSchedules[roundIndex].end} (${gp_timeInterval}ë¶„)`;
const header=document.createElement('div');
header.style.marginBottom='15px';
header.appendChild(title);header.appendChild(timeInfo);
roundDiv.appendChild(header)
}else{roundDiv.appendChild(title)}
const groupsContainer=document.createElement('div');
groupsContainer.className='groups';
arrangement.forEach((group,groupIndex)=>{
const groupDiv=document.createElement('div');
groupDiv.className='group';
const groupHeader=document.createElement('div');
groupHeader.className='group-header';
groupHeader.textContent=`${gp_groupNames[groupIndex]||`ê·¸ë£¹ ${groupIndex+1}`} (${group.length}ëª…)`;
groupDiv.appendChild(groupHeader);
const membersContainer=document.createElement('div');
membersContainer.className='group-members';
group.forEach(participantIndex=>{
const member=document.createElement('span');
member.className='member';
member.textContent=gp_participants[participantIndex];
membersContainer.appendChild(member)
});
groupDiv.appendChild(membersContainer);
groupsContainer.appendChild(groupDiv)
});
roundDiv.appendChild(groupsContainer);
container.appendChild(roundDiv)
});
gp_displayStats()
}

function gp_displayStats(){
const statsGrid=document.getElementById('gp_statsGrid');
statsGrid.innerHTML='';
const stats=gp_calculateStats();
const statsItems=[
{label:'ì´ ì°¸ì„ì',value:gp_participants.length+'ëª…'},
{label:'ê·¸ë£¹ ìˆ˜',value:parseInt(document.getElementById('gp_groupsCount').value)+'ê°œ'},
{label:'ë°°ì¹˜ íšŸìˆ˜',value:gp_results.length+'íšŒ'},
{label:'í‰ê·  ë§Œë‚¨',value:stats.avgMeetings.toFixed(1)+'íšŒ'},
{label:'ìµœëŒ€ ë§Œë‚¨',value:stats.maxMeetings+'íšŒ'},
{label:'ì•ˆë§Œë‚œ ìŒ',value:stats.neverMet+'ìŒ'}
];
statsItems.forEach(item=>{
const statDiv=document.createElement('div');
statDiv.className='stat';
statDiv.innerHTML=`<div class="stat-value">${item.value}</div><div class="stat-label">${item.label}</div>`;
statsGrid.appendChild(statDiv)
})
}

function gp_calculateStats(){
const participantCount=gp_participants.length;
const meetingMatrix=gp_createMeetingMatrix(participantCount);
gp_results.forEach(arrangement=>{gp_updateMeetingMatrix(meetingMatrix,arrangement)});
let totalMeetings=0;let maxMeetings=0;let neverMet=0;let pairCount=0;
for(let i=0;i<participantCount;i++){
for(let j=i+1;j<participantCount;j++){
const meetings=meetingMatrix[i][j];
totalMeetings+=meetings;
maxMeetings=Math.max(maxMeetings,meetings);
if(meetings===0){neverMet++}
pairCount++
}
}
return{avgMeetings:pairCount>0?totalMeetings/pairCount:0,maxMeetings,neverMet}
}

function gp_copyText(){
let text='ğŸ¯ ê·¸ë£¹ ë°°ì¹˜ ê²°ê³¼\n'+'='.repeat(50)+'\n';
const roundCount=parseInt(document.getElementById('gp_roundsCount').value);
const timeSchedules=gp_calculateTimeSchedule(gp_startTime,roundCount,gp_timeInterval);
gp_results.forEach((arrangement,roundIndex)=>{
text+=`ğŸ”„ ${roundIndex+1}íšŒì°¨ ë°°ì¹˜\n`;
if(timeSchedules[roundIndex]){text+=`â° ${timeSchedules[roundIndex].start} ~ ${timeSchedules[roundIndex].end} (${gp_timeInterval}ë¶„)\n`}
arrangement.forEach((group,groupIndex)=>{
const groupName=gp_groupNames[groupIndex]||`ê·¸ë£¹ ${groupIndex+1}`;
text+=`${groupName} (${group.length}ëª…): `;
text+=group.map(participantIndex=>gp_participants[participantIndex]).join(', ');
text+='\n'
});
text+='-'.repeat(30)+'\n'
});
text+='='.repeat(50);
navigator.clipboard.writeText(text).then(()=>{
gp_showAlert('success','ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹')
}).catch(error=>{
const textarea=document.createElement('textarea');
textarea.value=text;document.body.appendChild(textarea);textarea.select();document.execCommand('copy');document.body.removeChild(textarea);
gp_showAlert('success','ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹')
})
}

// ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
document.addEventListener('DOMContentLoaded',function(){
// ì¹´ì¹´ì˜¤í†¡ ë¶„ì„ ì´ë²¤íŠ¸
const fileInput=document.getElementById('kt_fileInput');
const uploadZone=document.getElementById('kt_uploadZone');

uploadZone.addEventListener('click',()=>fileInput.click());
fileInput.addEventListener('change',e=>{if(e.target.files.length>0)kt_handleFile(e.target.files[0])});

uploadZone.addEventListener('dragover',e=>{e.preventDefault();uploadZone.classList.add('drag-over')});
uploadZone.addEventListener('dragleave',e=>{e.preventDefault();uploadZone.classList.remove('drag-over')});
uploadZone.addEventListener('drop',e=>{e.preventDefault();uploadZone.classList.remove('drag-over');if(e.dataTransfer.files.length>0)kt_handleFile(e.dataTransfer.files[0])});

document.getElementById('kt_transposeBtn').addEventListener('click',kt_transpose);

document.getElementById('kt_downloadBtn').addEventListener('click',()=>{
const data=kt_state.filtered[kt_state.currentTab];
if(data.length===0){alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');return}
kt_utils.downloadCSV(data,`kakao_${kt_state.currentTab}_${new Date().toISOString().split('T')[0]}.csv`)
});

document.getElementById('kt_downloadMessagesBtn').addEventListener('click',()=>{
if(kt_state.data.messages.length===0){alert('ë‹¤ìš´ë¡œë“œí•  ë©”ì‹œì§€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');return}
kt_utils.downloadCSV(kt_state.data.messages,`kakao_messages_${new Date().toISOString().split('T')[0]}.csv`)
});

document.getElementById('kt_clearFilters').addEventListener('click',()=>{
kt_state.filters={};kt_state.sorts={};
kt_state.filtered={messages:[],summary:[...kt_state.data.summary],active:[...kt_state.data.active],inactive:[...kt_state.data.inactive]};
kt_updateCounts();kt_updateTable();
document.querySelectorAll('.fd').forEach(d=>d.style.display='none')
});

document.addEventListener('click',e=>{
if(!e.target.closest('.cb2')&&!e.target.closest('.fd'))document.querySelectorAll('.fd').forEach(d=>d.style.display='none')
});

// ê°€ë¡œ ìŠ¤í¬ë¡¤ë°” ë™ê¸°í™”
const ktTableWrapper=document.getElementById('kt_tableWrapper');
const ktScrollbar=document.getElementById('kt_horizontalScrollbar');
if(ktTableWrapper&&ktScrollbar){
ktTableWrapper.addEventListener('scroll',()=>ktScrollbar.scrollLeft=ktTableWrapper.scrollLeft);
ktScrollbar.addEventListener('scroll',()=>ktTableWrapper.scrollLeft=ktScrollbar.scrollLeft);
window.addEventListener('resize',kt_updateScrollbar);
const observer=new MutationObserver(kt_updateScrollbar);
observer.observe(ktTableWrapper,{childList:true,subtree:true,attributes:true,attributeFilter:['class']});
}

// ê·¸ë£¹ ë°°ì¹˜ ì´ë²¤íŠ¸
gp_updateParticipantsGrid();
gp_updateGroupNamesGrid();

document.getElementById('gp_startTimePicker').addEventListener('change',function(){
gp_startTime=this.value;
document.getElementById('gp_startTimeDisplay').textContent=`ì‹œì‘: ${this.value}`
});
});
</script>
</body>
</html>